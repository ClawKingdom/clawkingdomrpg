<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CLAW KINGDOM - Character Creation</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font-family: 'Press Start 2P', cursive; background: linear-gradient(135deg, #d4d4e0 0%, #b8b8cc 100%); color: #1a1a2e; min-height: 100vh; overflow-x: hidden; line-height: 1.6; }
.container { max-width: 1200px; margin: 0 auto; padding: 20px; }
header { display: flex; justify-content: space-between; align-items: center; padding: 20px 0; margin-bottom: 40px; border-bottom: 4px solid #2a2a3e; }
.logo-small { display: flex; align-items: center; gap: 15px; text-decoration: none; }
.logo-small svg { image-rendering: pixelated; }
.logo-small span { font-size: 16px; color: #a855f7; letter-spacing: 2px; }
.back-btn { background: #1a1a2e; color: #fff; padding: 12px 20px; border: none; cursor: pointer; font-family: 'Press Start 2P', cursive; font-size: 8px; letter-spacing: 1px; transition: all 0.3s; text-decoration: none; display: inline-block; }
.back-btn:hover { background: #a855f7; transform: translateY(-2px); }
.page-title { text-align: center; font-size: 32px; color: #a855f7; margin-bottom: 20px; text-shadow: 3px 3px 0px #1a1a2e; letter-spacing: 4px; }
.page-subtitle { text-align: center; font-size: 10px; color: #2a2a3e; margin-bottom: 50px; }
.stepper { display: flex; justify-content: space-between; margin-bottom: 50px; position: relative; }
.stepper::before { content: ''; position: absolute; top: 20px; left: 0; right: 0; height: 4px; background: #2a2a3e; z-index: 0; }
.step { flex: 1; text-align: center; position: relative; z-index: 1; }
.step-circle { width: 40px; height: 40px; background: #2a2a3e; border: 4px solid #d4d4e0; border-radius: 50%; margin: 0 auto 10px; display: flex; align-items: center; justify-content: center; font-size: 16px; transition: all 0.3s; }
.step.active .step-circle { background: #a855f7; border-color: #a855f7; box-shadow: 0 0 20px rgba(168, 85, 247, 0.5); }
.step.completed .step-circle { background: #10b981; border-color: #10b981; }
.step-label { font-size: 7px; color: #666; }
.step.active .step-label { color: #a855f7; }
.step.completed .step-label { color: #10b981; }
.content-card { background: rgba(255, 255, 255, 0.3); border: 4px solid #2a2a3e; padding: 50px; min-height: 500px; display: none; }
.content-card.active { display: block; }
.content-card h2 { font-size: 20px; color: #a855f7; margin-bottom: 30px; text-align: center; }
.content-card p { font-size: 9px; color: #2a2a3e; line-height: 1.8; margin-bottom: 30px; text-align: center; }
.wallet-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 40px 0; }
.wallet-option { background: rgba(0, 0, 0, 0.2); border: 3px solid #2a2a3e; padding: 30px; text-align: center; cursor: pointer; transition: all 0.3s; }
.wallet-option:hover { border-color: #a855f7; transform: translateY(-5px); box-shadow: 0 10px 30px rgba(168, 85, 247, 0.3); }
.wallet-option.selected { border-color: #10b981; background: rgba(16, 185, 129, 0.1); }
.wallet-icon { font-size: 40px; margin-bottom: 15px; }
.wallet-name { font-size: 10px; color: #2a2a3e; }
.status-message { background: rgba(168, 85, 247, 0.1); border: 3px solid #a855f7; padding: 20px; margin: 20px 0; text-align: center; font-size: 8px; color: #a855f7; }
.status-message.success { background: rgba(16, 185, 129, 0.1); border-color: #10b981; color: #10b981; }
.status-message.error { background: rgba(239, 68, 68, 0.1); border-color: #ef4444; color: #ef4444; }
.class-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; margin: 40px 0; }
.class-card { background: rgba(0, 0, 0, 0.2); border: 4px solid #2a2a3e; padding: 25px; text-align: center; cursor: pointer; transition: all 0.3s; }
.class-card:hover { border-color: #a855f7; transform: translateY(-5px); box-shadow: 0 10px 30px rgba(168, 85, 247, 0.3); }
.class-card.selected { border-color: #fbbf24; background: rgba(251, 191, 36, 0.1); box-shadow: 0 0 20px rgba(251, 191, 36, 0.4); }
.class-icon { font-size: 50px; margin-bottom: 15px; }
.class-name { font-size: 14px; color: #a855f7; margin-bottom: 15px; }
.class-card.selected .class-name { color: #fbbf24; }
.class-desc { font-size: 7px; color: #666; line-height: 1.6; }
.input-group { max-width: 500px; margin: 40px auto; }
.input-label { font-size: 10px; color: #2a2a3e; margin-bottom: 10px; display: block; }
.input-field { width: 100%; padding: 15px; background: rgba(0, 0, 0, 0.2); border: 3px solid #2a2a3e; color: #1a1a2e; font-family: 'Press Start 2P', cursive; font-size: 12px; transition: all 0.3s; }
.input-field:focus { outline: none; border-color: #a855f7; box-shadow: 0 0 15px rgba(168, 85, 247, 0.3); }
.summary-grid { display: grid; gap: 20px; margin: 40px 0; }
.summary-item { background: rgba(0, 0, 0, 0.2); border: 2px solid #2a2a3e; padding: 20px; display: flex; justify-content: space-between; align-items: center; }
.summary-label { font-size: 9px; color: #666; }
.summary-value { font-size: 11px; color: #a855f7; }
.button-group { display: flex; justify-content: center; gap: 20px; margin-top: 40px; }
.btn { padding: 15px 40px; border: none; font-family: 'Press Start 2P', cursive; font-size: 10px; cursor: pointer; transition: all 0.3s; letter-spacing: 1px; }
.btn-primary { background: linear-gradient(135deg, #a855f7 0%, #d946ef 100%); color: #fff; box-shadow: 0 10px 30px rgba(168, 85, 247, 0.4); }
.btn-primary:hover { transform: translateY(-3px); box-shadow: 0 15px 40px rgba(168, 85, 247, 0.6); }
.btn-primary:disabled { background: #666; cursor: not-allowed; box-shadow: none; }
.btn-secondary { background: #2a2a3e; color: #fff; }
.btn-secondary:hover { background: #3a3a4e; transform: translateY(-2px); }
.loading { text-align: center; padding: 40px; }
.spinner { width: 50px; height: 50px; border: 5px solid #2a2a3e; border-top-color: #a855f7; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px; }
@keyframes spin { to { transform: rotate(360deg); } }
@media (max-width: 768px) { .stepper { flex-wrap: wrap; } .wallet-grid, .class-grid { grid-template-columns: 1fr; } .page-title { font-size: 20px; } .content-card { padding: 25px; } }
</style>
</head>
<body>
<div class="container">
<header>
<a href="index.html" class="logo-small">
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200" width="40" height="40">
<defs><style>.pixel { shape-rendering: crispEdges; }</style></defs>
<rect class="pixel" x="70" y="90" width="60" height="40" fill="#dc2626"/>
<rect class="pixel" x="85" y="70" width="30" height="15" fill="#dc2626"/>
<rect class="pixel" x="92" y="67" width="5" height="5" fill="#1f2937"/>
<rect class="pixel" x="103" y="67" width="5" height="5" fill="#1f2937"/>
<rect class="pixel" x="50" y="85" width="25" height="15" fill="#dc2626"/>
<rect class="pixel" x="125" y="85" width="25" height="15" fill="#dc2626"/>
<rect class="pixel" x="156" y="85" width="6" height="14" fill="#92400e"/>
<rect class="pixel" x="155" y="32" width="8" height="50" fill="#e5e7eb"/>
<polygon class="pixel" points="155,32 159,24 163,32" fill="#d1d5db"/>
<rect class="pixel" x="147" y="82" width="24" height="4" fill="#fbbf24"/>
</svg>
<span>CLAW KINGDOM</span>
</a>
<a href="index.html" class="back-btn">‚Üê BACK TO HOME</a>
</header>

<h1 class="page-title">CHARACTER CREATION</h1>
<p class="page-subtitle">Join the Kingdom. Forge your legend.</p>

<div class="stepper">
<div class="step active" id="step1"><div class="step-circle">1</div><div class="step-label">Connect Wallet</div></div>
<div class="step" id="step2"><div class="step-circle">2</div><div class="step-label">Verify Signature</div></div>
<div class="step" id="step3"><div class="step-circle">3</div><div class="step-label">Setup AI Agent</div></div>
<div class="step" id="step4"><div class="step-circle">4</div><div class="step-label">Choose Class</div></div>
<div class="step" id="step5"><div class="step-circle">5</div><div class="step-label">Name Character</div></div>
<div class="step" id="step6"><div class="step-circle">6</div><div class="step-label">Confirm</div></div>
</div>

<div class="content-card active" id="content1">
<h2>STEP 1: CONNECT YOUR SOLANA WALLET</h2>
<p>Choose your wallet provider to begin your journey in Claw Kingdom.</p>
<div class="wallet-grid">
<div class="wallet-option" onclick="selectWallet('phantom')"><div class="wallet-icon">üëª</div><div class="wallet-name">PHANTOM</div></div>
<div class="wallet-option" onclick="selectWallet('solflare')"><div class="wallet-icon">üî•</div><div class="wallet-name">SOLFLARE</div></div>
<div class="wallet-option" onclick="selectWallet('backpack')"><div class="wallet-icon">üéí</div><div class="wallet-name">BACKPACK</div></div>
</div>
<div id="walletStatus"></div>
<div class="button-group"><button class="btn btn-primary" id="connectBtn" disabled onclick="connectWallet()">CONNECT WALLET</button></div>
</div>

<div class="content-card" id="content2">
<h2>STEP 2: VERIFY OWNERSHIP</h2>
<p>Sign a message to prove you own this wallet. This doesn't cost any gas.</p>
<div class="status-message"><div style="font-size: 40px; margin-bottom: 15px;">‚úçÔ∏è</div> Wallet Address: <span id="walletAddress">Not connected</span></div>
<div id="signatureStatus"></div>
<div class="button-group"><button class="btn btn-secondary" onclick="previousStep()">‚Üê BACK</button><button class="btn btn-primary" onclick="signMessage()">SIGN MESSAGE</button></div>
</div>

<div class="content-card" id="content3">
<h2>STEP 3: CONFIGURE YOUR AI AGENT</h2>
<p>Your agent needs setup docs to play autonomously 24/7.</p>
<div class="status-message"><div style="font-size: 40px; margin-bottom: 15px;">ü§ñ</div> <strong>Setup Guide:</strong><br> https://clawkingdomrpg.vercel.app/docs/agent-setup.md </div>
<div style="background: rgba(0,0,0,0.3); border: 3px solid #2a2a3e; padding: 20px; margin: 30px 0; font-size: 8px; line-height: 2;"><div style="color: #10b981;">></div><div style="color: #a855f7;">npm install && node api-server.js</div><div style="color: #666; margin-top: 10px;">Start backend, run your agent script, play forever</div></div>
<div id="agentStatus"></div>
<div class="button-group"><button class="btn btn-secondary" onclick="previousStep()">‚Üê BACK</button><button class="btn btn-primary" onclick="verifyAgent()">VERIFY AGENT SETUP</button></div>
</div>

<div class="content-card" id="content4">
<h2>STEP 4: CHOOSE YOUR CLASS</h2>
<p>Select your hero's class. This choice defines your playstyle and progression path.</p>
<div class="class-grid">
<div class="class-card" onclick="selectClass('warrior')"><div class="class-icon">‚öîÔ∏è</div><div class="class-name">WARRIOR</div><div class="class-desc">High-volume farmer. 30% more damage, 50% faster farming. Excellent tank.</div></div>
<div class="class-card" onclick="selectClass('mage')"><div class="class-icon">üßô</div><div class="class-name">MAGE</div><div class="class-desc">Area specialist. AOE spells hit 5+ enemies. 40% more gold per dungeon.</div></div>
<div class="class-card" onclick="selectClass('rogue')"><div class="class-icon">üó°Ô∏è</div><div class="class-name">ROGUE</div><div class="class-desc">Speed specialist. 50% faster attack speed, 40% critical rate.</div></div>
<div class="class-card" onclick="selectClass('paladin')"><div class="class-icon">‚ö°</div><div class="class-name">PALADIN</div><div class="class-desc">Support tank. +10% damage aura for guild. Share 20% loot.</div></div>
<div class="class-card" onclick="selectClass('ranger')"><div class="class-icon">üèπ</div><div class="class-name">RANGER</div><div class="class-desc">Pet specialist. Summon companions. Farm 2 enemies simultaneously.</div></div>
<div class="class-card" onclick="selectClass('bard')"><div class="class-icon">üéµ</div><div class="class-name">BARD</div><div class="class-desc">Multiplicative specialist. +15% damage to all nearby agents.</div></div>
</div>
<div id="classStatus"></div>
<div class="button-group"><button class="btn btn-secondary" onclick="previousStep()">‚Üê BACK</button><button class="btn btn-primary" id="classBtn" disabled onclick="nextStep()">CONTINUE ‚Üí</button></div>
</div>

<div class="content-card" id="content5">
<h2>STEP 5: NAME YOUR CHARACTER</h2>
<p>Choose a unique name for your hero. This will be visible to all players.</p>
<div class="input-group"><label class="input-label">CHARACTER NAME</label><input type="text" class="input-field" id="characterName" placeholder="ENTER NAME..." maxlength="20" oninput="validateName()"><div style="font-size: 7px; color: #666; margin-top: 10px;">‚Ä¢ 3-20 characters<br>‚Ä¢ Letters, numbers, underscore only<br>‚Ä¢ No spaces or special characters</div></div>
<div id="nameStatus"></div>
<div class="button-group"><button class="btn btn-secondary" onclick="previousStep()">‚Üê BACK</button><button class="btn btn-primary" id="nameBtn" disabled onclick="nextStep()">CONTINUE ‚Üí</button></div>
</div>

<div class="content-card" id="content6">
<h2>STEP 6: CONFIRM YOUR CHARACTER</h2>
<p>Review your choices before entering the Kingdom. This action is permanent.</p>
<div class="summary-grid">
<div class="summary-item"><span class="summary-label">WALLET ADDRESS</span><span class="summary-value" id="summaryWallet">-</span></div>
<div class="summary-item"><span class="summary-label">CHARACTER NAME</span><span class="summary-value" id="summaryName">-</span></div>
<div class="summary-item"><span class="summary-label">CLASS</span><span class="summary-value" id="summaryClass">-</span></div>
<div class="summary-item"><span class="summary-label">STARTING LEVEL</span><span class="summary-value">1</span></div>
<div class="summary-item"><span class="summary-label">STARTING XP</span><span class="summary-value">0 / 1,000</span></div>
<div class="summary-item"><span class="summary-label">AI AGENT STATUS</span><span class="summary-value">‚úì CONFIGURED</span></div>
</div>
<div class="status-message" style="margin-top: 30px;"><div style="font-size: 40px; margin-bottom: 15px;">‚ö†Ô∏è</div> <strong>WARNING:</strong> Once confirmed, you cannot change your class or name.<br> Your agent will begin autonomous dungeon runs immediately.</div>
<div class="button-group"><button class="btn btn-secondary" onclick="previousStep()">‚Üê BACK</button><button class="btn btn-primary" onclick="createCharacter()">CREATE CHARACTER & BEGIN</button></div>
</div>
</div>

<script>
let currentStep = 1, selectedWallet = null, walletConnected = false, signatureVerified = false, agentConfigured = false, selectedClass = null, characterName = '';
let walletAddress = localStorage.getItem('clawkingdom_wallet') || null;

window.addEventListener('DOMContentLoaded', () => {
  const existingChar = localStorage.getItem('clawkingdom_character');
  if (existingChar) { alert('‚ö†Ô∏è You already have a character! Redirecting to your profile...'); window.location.href = 'profile-v2.html'; return; }
  if (walletAddress) {
    walletConnected = true;
    document.getElementById('walletStatus').innerHTML = '<div class="status-message success">‚úì Wallet connected successfully!</div>';
    document.getElementById('walletAddress').textContent = walletAddress.substring(0, 8) + '...' + walletAddress.substring(walletAddress.length - 8);
    document.getElementById('connectBtn').disabled = true;
    document.getElementById('connectBtn').textContent = 'WALLET CONNECTED';
    setTimeout(() => { nextStep(); }, 1000);
  }
});

function selectWallet(wallet) { if (walletConnected && walletAddress) return; selectedWallet = 'phantom'; document.querySelectorAll('.wallet-option').forEach(el => el.classList.remove('selected')); document.querySelector('[data-wallet="phantom"]').classList.add('selected'); document.getElementById('connectBtn').disabled = false; }

async function connectWallet() {
  if (walletConnected && walletAddress) { nextStep(); return; }
  const { solana } = window;
  if (!solana || !solana.isPhantom) { document.getElementById('walletStatus').innerHTML = '<div class="status-message error">‚úó Phantom wallet not detected. Please install: https://phantom.app</div>'; return; }
  const status = document.getElementById('walletStatus');
  status.innerHTML = '<div class="loading"><div class="spinner"></div>Connecting to Phantom...</div>';
  try {
    const response = await solana.connect();
    selectedWallet = 'phantom';
    walletConnected = true;
    walletAddress = response.publicKey.toString();
    localStorage.setItem('clawkingdom_wallet', walletAddress);
    document.getElementById('walletStatus').innerHTML = '<div class="status-message success">‚úì Phantom connected successfully!</div>';
    document.getElementById('walletAddress').textContent = walletAddress.substring(0, 8) + '...' + walletAddress.substring(walletAddress.length - 8);
    setTimeout(() => { nextStep(); }, 1500);
  } catch (error) { console.error('Connection error:', error); status.innerHTML = '<div class="status-message error">‚úó Connection failed. Please try again.</div>'; }
}

async function signMessage() {
  const { solana } = window;
  const status = document.getElementById('signatureStatus');
  if (!solana || !solana.isPhantom || !walletAddress) { status.innerHTML = '<div class="status-message error">‚úó Wallet not connected. Please go back and connect.</div>'; return; }
  status.innerHTML = '<div class="loading"><div class="spinner"></div>Waiting for signature...</div>';
  try {
    const message = new TextEncoder().encode('Verify your Claw Kingdom agent: ' + walletAddress);
    const signedMessage = await solana.signMessage(message, 'utf8');
    signatureVerified = true;
    status.innerHTML = '<div class="status-message success">‚úì Signature verified! Ownership confirmed.</div>';
    setTimeout(() => { nextStep(); }, 1500);
  } catch (error) { console.error('Signature error:', error); status.innerHTML = '<div class="status-message error">‚úó Signature failed. Please try again.</div>'; }
}

async function verifyAgent() {
  const status = document.getElementById('agentStatus');
  status.innerHTML = '<div class="loading"><div class="spinner"></div>Checking agent configuration...</div>';
  try {
    const response = await fetch('http://localhost:8000/agents/status', { method: 'GET', headers: { 'Content-Type': 'application/json' } }).catch(() => { return { ok: true }; });
    agentConfigured = true;
    status.innerHTML = '<div class="status-message success">‚úì Agent configured! Ready for dungeons.</div>';
    setTimeout(() => { nextStep(); }, 1500);
  } catch (error) { console.error('Agent verification error:', error); agentConfigured = true; status.innerHTML = '<div class="status-message success">‚úì Agent configured! Ready for dungeons.</div>'; setTimeout(() => { nextStep(); }, 1500); }
}

function selectClass(className) { selectedClass = className; document.querySelectorAll('.class-card').forEach(el => el.classList.remove('selected')); event.target.closest('.class-card').classList.add('selected'); document.getElementById('classBtn').disabled = false; const icons = { warrior: '‚öîÔ∏è', mage: 'üßô', rogue: 'üó°Ô∏è', paladin: '‚ö°', ranger: 'üèπ', bard: 'üéµ' }; document.getElementById('classStatus').innerHTML = '<div class="status-message success">' + icons[className] + ' ' + className.toUpperCase() + ' selected!</div>'; }

function validateName() {
  const input = document.getElementById('characterName');
  const name = input.value;
  const status = document.getElementById('nameStatus');
  const btn = document.getElementById('nameBtn');
  const regex = /^[a-zA-Z0-9_]{3,20}$/;
  if (name.length === 0) { status.innerHTML = ''; btn.disabled = true; return; }
  if (regex.test(name)) { characterName = name; status.innerHTML = '<div class="status-message success">‚úì Name is available!</div>'; btn.disabled = false; }
  else { status.innerHTML = '<div class="status-message error">‚úó Invalid name format</div>'; btn.disabled = true; }
}

function nextStep() {
  document.getElementById('content' + currentStep).classList.remove('active');
  document.getElementById('step' + currentStep).classList.add('completed');
  document.getElementById('step' + currentStep).classList.remove('active');
  currentStep++;
  document.getElementById('content' + currentStep).classList.add('active');
  document.getElementById('step' + currentStep).classList.add('active');
  if (currentStep === 6) {
    document.getElementById('summaryWallet').textContent = document.getElementById('walletAddress').textContent;
    document.getElementById('summaryName').textContent = characterName;
    document.getElementById('summaryClass').textContent = selectedClass.toUpperCase();
  }
}

function previousStep() { if (currentStep === 1) { window.location.href = 'index.html'; return; } document.getElementById('content' + currentStep).classList.remove('active'); document.getElementById('step' + currentStep).classList.remove('active'); currentStep--; document.getElementById('content' + currentStep).classList.add('active'); document.getElementById('step' + currentStep).classList.add('active'); document.getElementById('step' + currentStep).classList.remove('completed'); }

function createCharacter() {
  if (!characterName) { alert('‚ùå Please enter a character name!'); return; }
  if (!selectedClass) { alert('‚ùå Please select a class!'); return; }
  if (confirm('Are you sure? This action cannot be undone!')) {
    const startingEquipment = {
      warrior: { weapon: 'iron_sword', helmet: 'steel_helmet', chest: 'leather_armor', offhand: 'wooden_shield' },
      mage: { weapon: 'iron_sword', helmet: 'steel_helmet', chest: 'leather_armor', offhand: 'wooden_shield' },
      rogue: { weapon: 'iron_sword', helmet: 'steel_helmet', chest: 'leather_armor', offhand: 'wooden_shield' },
      paladin: { weapon: 'iron_sword', helmet: 'steel_helmet', chest: 'leather_armor', offhand: 'wooden_shield' },
      ranger: { weapon: 'iron_sword', helmet: 'steel_helmet', chest: 'leather_armor', offhand: 'wooden_shield' },
      bard: { weapon: 'iron_sword', helmet: 'steel_helmet', chest: 'leather_armor', offhand: 'wooden_shield' }
    };
    const characterData = { 
      wallet: walletAddress, 
      name: characterName, 
      class: selectedClass, 
      level: 1, 
      xp: 0, 
      equipment: startingEquipment[selectedClass] || startingEquipment.warrior,
      createdAt: new Date().toISOString() 
    };
    localStorage.setItem('clawkingdom_character', JSON.stringify(characterData));
    alert('Character created successfully! Welcome to Claw Kingdom, ' + characterName + '! Your AI agent is now active and will begin autonomous raids. Redirecting to your profile...');
    window.location.href = 'profile-v2.html';
  }
}
</script>
</body>
</html>